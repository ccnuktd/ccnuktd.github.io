# Socket编程
## 1. 简介
### 网络设计接口
>有哪些可以编程的方式？
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071017186.png)
### 应用编程接口
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071020785.png)
#### 几种典型的应用编程接口
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071022030.png)
### 套接字API
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071030309.png)
客户端通过IP地址确定进程属于哪一台主机，通过端口号确定进程是主机中的哪一个进程。这是服务器对外的标识。对内，操作系统在创建套接字的时候会产生<font color="red">socket descripter</font>（套接字描述符），并使用套接字描述符进行管理。
### Socket抽象
**这种抽象机制和文件的抽象非常类似。**
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071036005.png)
### 地址结构
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071038197.png)
## 2. 如何使用API
### 套接字API具体介绍
在Windows操作系统中需要按照这个步骤调用
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071040415.png)
#### WSAStartup
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071042921.png)
#### WSACleanup
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071043233.png)
#### socket
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071046121.png)
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071048789.png)
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071050869.png)
### closesocket
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071052211.png)
#### bind
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071054563.png)
绑定会出现这样的情况，如果一个电脑有多个IP地址，那么需要绑定哪一个呢？
实际上，API函数提供了这样一个参数**INADDR_ANY**，这个参数表示任何的有效地址都算。
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071105879.png)
#### listen
只有服务器需要使用，因为服务器需要监听端口的请求。
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071106881.png)
#### connect
只有客户端需要使用，因为客户端需要连接。
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071109076.png)
#### accept
服务器调用accept函数从队列中取出一个客户端请求，并创建一个**新套接字**进行连接。
之所以要创建新的套接字而不是使用老的，是因为创建新套接字可以实现并发的处理，通过多线程的机制，就可以实现服务器为多个客户端提供服务。
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071114463.png)
#### send，sendto
send用在connect状态下，sendto用在无connect下。
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071116909.png)
#### recv，recvfrom
和上面的send，sendto相似。
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071117616.png)
### API函数小结
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071123860.png)
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071123771.png)
### 关于网络字节顺序
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071126357.png)
### 调用流程
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071405992.png)
## 3.软件设计注意事项
### 解析类函数
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071410388.png)
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071410874.png)
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071410551.png)
### TCP和UDP客户端软件流程对比
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071418065.png)
![](https://gitee.com/ccnuktd/pic-bed/raw/master/202202071418915.png)
